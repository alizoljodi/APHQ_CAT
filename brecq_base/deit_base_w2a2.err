2025-09-08 15:04:28,594 - INFO - Starting multi-seed experiment
2025-09-08 15:04:28,594 - INFO - Architecture: deit_base
2025-09-08 15:04:28,594 - INFO - Weight bits: 2
2025-09-08 15:04:28,594 - INFO - Activation bits: 2
2025-09-08 15:04:28,594 - INFO - Seeds: [1001, 1002, 1003]
2025-09-08 15:04:28,594 - INFO - Alpha values: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]
2025-09-08 15:04:28,594 - INFO - Cluster numbers: [8, 16, 32, 64, 128, 256]
2025-09-08 15:04:28,594 - INFO - PCA dimensions: [1, 25, 50, 75, 100, 125, 150, 175, 200, 220]
2025-09-08 15:04:28,594 - INFO - Output directory: ./experiment_results/deit_base_w2_a2_20250908_150428
2025-09-08 15:04:28,594 - INFO - Checking basic requirements...
2025-09-08 15:04:28,595 - INFO - Basic checks passed
2025-09-08 15:04:28,595 - INFO - 
Starting experiments for 3 seeds...
2025-09-08 15:04:28,595 - INFO - Total parameter combinations: 600
2025-09-08 15:04:28,595 - INFO - Total experiments: 1800
2025-09-08 15:04:28,595 - INFO - 
============================================================
2025-09-08 15:04:28,595 - INFO - Running experiment 1/3 for seed 1001
2025-09-08 15:04:28,595 - INFO - ============================================================
2025-09-08 15:04:28,595 - INFO - Running experiment for seed 1001
2025-09-08 15:04:28,595 - INFO - Command: /home/alz07xz/project/PD-Quant/pd_quant/bin/python ../test_quant.py --model deit_base --w_bit 2 --a_bit 2 --seed 1001 --config ../configs/4bit/best.py --dataset /home/alz07xz/imagenet --calib-size 1000 --calib-batch-size 32 --val-batch-size 500 --num-workers 8 --device cuda --alpha-list 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0 --num-clusters-list 8 16 32 64 128 256 --pca-dim-list 1 25 50 75 100 125 150 175 200 220 --calibrate --optimize
2025-09-08 15:04:28,595 - INFO - Working directory: /home/alz07xz/project/APHQ_CAT/brecq_base
2025-09-08 15:11:04 - start the process.
Namespace(model='deit_base', config='../configs/4bit/best.py', dataset='/home/alz07xz/imagenet', val_batch_size=500, num_workers=8, device='cuda', reconstruct_mlp=False, load_reconstruct_checkpoint=False, test_reconstruct_checkpoint=False, calibrate=True, load_calibrate_checkpoint=None, test_calibrate_checkpoint=False, optimize=True, load_optimize_checkpoint='', test_optimize_checkpoint=False, print_freq=10, seed=1001, alpha_list=[0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0], num_clusters_list=[8, 16, 32, 64, 128, 256], pca_dim_list=[1, 25, 50, 75, 100, 125, 150, 175, 200, 220], w_bit=2, a_bit=2, calib_size=1000, calib_batch_size=32)
Successfully imported Config class!
optim_size: 1024
calib_size: 1000
optim_batch_size: 32
calib_batch_size: 32
w_bit: 2
a_bit: 2
qconv_a_bit: 8
qhead_a_bit: 4
calib_metric: mse
matmul_head_channel_wise: True
token_channel_wise: False
eq_n: 128
search_round: 3
keep_gpu: True
optim_metric: hessian_perturb
use_mean_hessian: True
temp: 20
recon_metric: hessian_perturb
pct: 0.98
optim_mode: qdrop
drop_prob: 0.5
reconstruct_mlp: False
Building model ...
No checkpoint found at './checkpoint/vit_raw/deit_base_patch16_224.bin'
Loading pretrained weights from Hugging Face hub (timm/deit_base_patch16_224.fb_in1k)
[timm/deit_base_patch16_224.fb_in1k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
Building validation dataloader ...
Validating on test set on fp ...
Test: [0/100]	Time 16.601 (16.601)	Loss 0.4608 (0.4608)	Prec@1 90.600 (90.600)	Prec@5 98.600 (98.600)
Test: [10/100]	Time 0.771 (2.549)	Loss 0.5691 (0.6237)	Prec@1 89.200 (86.582)	Prec@5 96.600 (97.473)
Test: [20/100]	Time 0.766 (1.901)	Loss 0.6565 (0.6262)	Prec@1 84.600 (86.752)	Prec@5 98.400 (97.533)
Test: [30/100]	Time 0.765 (1.782)	Loss 0.5879 (0.6391)	Prec@1 87.400 (86.348)	Prec@5 99.400 (97.548)
Test: [40/100]	Time 3.204 (1.751)	Loss 0.8276 (0.6411)	Prec@1 81.600 (86.317)	Prec@5 96.000 (97.507)
Test: [50/100]	Time 2.019 (1.695)	Loss 1.2987 (0.7189)	Prec@1 72.600 (84.408)	Prec@5 90.200 (96.710)
Test: [60/100]	Time 0.778 (1.562)	Loss 0.7880 (0.7396)	Prec@1 84.000 (83.977)	Prec@5 94.000 (96.462)
Test: [70/100]	Time 0.788 (1.459)	Loss 0.9197 (0.7745)	Prec@1 80.000 (83.039)	Prec@5 94.600 (96.127)
Test: [80/100]	Time 6.411 (1.515)	Loss 0.6823 (0.7935)	Prec@1 87.000 (82.738)	Prec@5 96.400 (95.849)
Test: [90/100]	Time 0.782 (1.464)	Loss 1.1798 (0.8183)	Prec@1 70.200 (82.015)	Prec@5 94.600 (95.679)
 * Prec@1 81.982 Prec@5 95.744 Loss 0.818 Time 144.805
Wraping quantiztion modules (reparam: False, recon: False) ...
2025-09-08 15:14:02 - start mse guided calibration
  0%|          | 0/74 [00:00<?, ?it/s]calibrating patch_embed.proj:   0%|          | 0/74 [00:00<?, ?it/s]calibrating patch_embed.proj:   1%|▏         | 1/74 [00:11<14:15, 11.72s/it]calibrating blocks.0.attn.qkv:   1%|▏         | 1/74 [00:11<14:15, 11.72s/it]calibrating blocks.0.attn.qkv:   3%|▎         | 2/74 [01:25<57:31, 47.94s/it]calibrating blocks.0.attn.proj:   3%|▎         | 2/74 [01:25<57:31, 47.94s/it]calibrating blocks.0.attn.proj:   4%|▍         | 3/74 [01:50<44:26, 37.56s/it]calibrating blocks.0.attn.matmul1:   4%|▍         | 3/74 [01:50<44:26, 37.56s/it]calibrating blocks.0.attn.matmul1:   5%|▌         | 4/74 [03:01<59:25, 50.93s/it]calibrating blocks.0.attn.matmul2:   5%|▌         | 4/74 [03:01<59:25, 50.93s/it]calibrating blocks.0.attn.matmul2:   7%|▋         | 5/74 [04:02<1:02:33, 54.40s/it]calibrating blocks.0.mlp.fc1:   7%|▋         | 5/74 [04:02<1:02:33, 54.40s/it]     slurmstepd-jnfat05: error: *** JOB 1643437 ON jnfat05 CANCELLED AT 2025-09-08T15:19:31 ***
